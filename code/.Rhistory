cli <- suppressMessages(
covidcast_signal(data_source = "fb-survey", signal = "smoothed_cli",
start_day = "2020-05-01", end_day = "2020-05-07",
geo_type = "msa")
)
knitr::kable(head(cli))
ox_region_path <- "../data/oxford/region/" # Oxford data
interest <- list.files(ox_region_path, pattern="*.csv", full.names=FALSE)
interest <- word(interest,1,sep = "-")
library(stringr)
interest <- word(interest,1,sep = "-")
interest <- grep("US", interest)
interest
interest <- list.files(ox_region_path, pattern="*.csv", full.names=FALSE)
interest
interest <- word(interest,1,sep = "-")
interest
interest <- grep("US", interest, fixed =TRUE)
interest
interest <- interest[grep("US", interest, fixed =TRUE)]
interest <- list.files(ox_region_path, pattern="*.csv", full.names=FALSE)
interest <- word(interest,1,sep = "-")
interest <- interest[grep("US", interest, fixed =TRUE)]
interest
states <- word(interest,2,sep = "_")
states
end_date <- Sys.Date()
end_date
# load library
library(covidcast)
library(dplyr)
library(stringr)
ox_region_path <- "../data/oxford/region/" # Oxford data
start_date <- "2020-01-01"
end_date <- Sys.Date()
cmu_ili_cli_signals <- c(
"raw_cli",
"smoothed_cli",
"raw_ili",
"smoothed_ili",
"raw_wcli",
"smoothed_wcli",
"raw_wili",
"smoothed_wili",
"raw_hh_cmnty_cli",
"smoothed_hh_cmnty_cli",
"raw_nohh_cmnty_cli",
"smoothed_nohh_cmnty_cli"
)
cmu_behavior_signals <- c(
"smoothed_wearing_mask",
"smoothed_others_masked",
"smoothed_travel_outside_state_5d",
"smoothed_work_outside_home_1d",
"smoothed_shop_1d",
"smoothed_restaurant_1d",
"smoothed_spent_time_1d",
"smoothed_large_event_1d",
"smoothed_public_transit_1d"
)
cmu_testing_signals <- c(
"smoothed_tested_14d",
"smoothed_tested_positive_14d",
"smoothed_wanted_test_14d"
)
cmu_mental_health_signals <- c(
"smoothed_anxious_5d",
"smoothed_depressed_5d",
"smoothed_felt_isolated_5d",
"smoothed_worried_become_ill",
"smoothed_worried_finances"
)
interest <- list.files(ox_region_path, pattern="*.csv", full.names=FALSE)
interest <- word(interest,1,sep = "-")
interest <- interest[grep("US", interest, fixed =TRUE)]
state_iso <- "US_LA"
signal <- "smoothed_cli"
state_code <- tolower(word(state_iso,2,sep = "_"))
df_aux <- covidcast_signal(data_source = "fb-survey", signal = signal,
start_day = start_date, end_day = end_date,
geo_type = "state", geo_value = state_code)
View(df_aux)
View(df_aux)
df_all <- data.frame(c("date", "iso2", cmu_ili_cli_signals))
df_all
signal
# load library
library(covidcast)
library(dplyr)
library(stringr)
ox_region_path <- "../data/oxford/region/" # Oxford data
start_date <- "2020-01-01"
end_date <- Sys.Date()
cmu_ili_cli_signals <- c(
"raw_cli",
"smoothed_cli",
"raw_ili",
"smoothed_ili",
"raw_wcli",
"smoothed_wcli",
"raw_wili",
"smoothed_wili",
"raw_hh_cmnty_cli",
"smoothed_hh_cmnty_cli",
"raw_nohh_cmnty_cli",
"smoothed_nohh_cmnty_cli"
)
cmu_behavior_signals <- c(
"smoothed_wearing_mask",
"smoothed_others_masked",
"smoothed_travel_outside_state_5d",
"smoothed_work_outside_home_1d",
"smoothed_shop_1d",
"smoothed_restaurant_1d",
"smoothed_spent_time_1d",
"smoothed_large_event_1d",
"smoothed_public_transit_1d"
)
cmu_testing_signals <- c(
"smoothed_tested_14d",
"smoothed_tested_positive_14d",
"smoothed_wanted_test_14d"
)
cmu_mental_health_signals <- c(
"smoothed_anxious_5d",
"smoothed_depressed_5d",
"smoothed_felt_isolated_5d",
"smoothed_worried_become_ill",
"smoothed_worried_finances"
)
interest <- list.files(ox_region_path, pattern="*.csv", full.names=FALSE)
interest <- word(interest,1,sep = "-")
interest <- interest[grep("US", interest, fixed =TRUE)]
state_iso <- "US_LA"
signal <- "smoothed_cli"
state_code <- tolower(word(state_iso,2,sep = "_"))
df_all <- data.frame(c("date", "iso2", cmu_ili_cli_signals))
df_aux <- covidcast_signal(data_source = "fb-survey", signal = signal,
start_day = start_date, end_day = end_date,
geo_type = "state", geo_value = state_code)
df_all["date"] <- df_aux$time_value
dim(df_all)
dim(df_aux)
df_all <- data.frame()
col_names(df_all) <- c("date", "iso2", cmu_ili_cli_signals)
names(df_all) <- c("date", "iso2", cmu_ili_cli_signals)
df_all <- data.frame(c("date", "iso2", cmu_ili_cli_signals), stringsAsFactors=FALSE)
dim (df_al)
dim (df_all)
df_all <- data.frame("date", "iso2", cmu_ili_cli_signals, stringsAsFactors=FALSE)
dim (df_all)
df_all
state_files <- list.files(ox_region_path, pattern="US_*.csv", full.names=FALSE)
state_codes <- word(state_files,1,sep = "-")
state_codes
state_files
ox_region_path <- "../data/oxford/region/" # Oxford data
state_files <- list.files(ox_region_path, pattern="US_*.csv", full.names=FALSE)
state_files
state_files <- list.files(ox_region_path, pattern="*.csv", full.names=FALSE)
state_files
state_files <- list.files(ox_region_path, pattern="*.csv", full.names=FALSE)
state_files <- interest[grep("US", state_files, fixed =TRUE)]
state_codes <- word(state_files,1,sep = "-")
state_files
state_files <- list.files(ox_region_path, pattern="*.csv", full.names=FALSE)
state_files
state_files <- state_files[grep("US", state_files, fixed =TRUE)]
state_files
state_codes <- word(state_files,1,sep = "-")
state_code
state_codes
source('~/github/xprize/code/script-get-CMU-covidcast-data.R', echo=TRUE)
source('~/github/xprize/code/script-get-CMU-covidcast-data.R', echo=TRUE)
# load library
library(covidcast)
library(dplyr)
library(stringr)
ox_region_path <- "../data/oxford/region/" # Oxford data
output_path <- "../data/CMU-covidcast/"
start_date <- "2020-01-01"
end_date <- Sys.Date()
cmu_ili_cli_signals <- c(
"raw_cli",
"smoothed_cli",
"raw_ili",
"smoothed_ili",
"raw_wcli",
"smoothed_wcli",
"raw_wili",
"smoothed_wili",
"raw_hh_cmnty_cli",
"smoothed_hh_cmnty_cli",
"raw_nohh_cmnty_cli",
"smoothed_nohh_cmnty_cli"
)
cmu_behavior_signals <- c(
"smoothed_wearing_mask",
"smoothed_others_masked",
"smoothed_travel_outside_state_5d",
"smoothed_work_outside_home_1d",
"smoothed_shop_1d",
"smoothed_restaurant_1d",
"smoothed_spent_time_1d",
"smoothed_large_event_1d",
"smoothed_public_transit_1d"
)
cmu_testing_signals <- c(
"smoothed_tested_14d",
"smoothed_tested_positive_14d",
"smoothed_wanted_test_14d"
)
cmu_mental_health_signals <- c(
"smoothed_anxious_5d",
"smoothed_depressed_5d",
"smoothed_felt_isolated_5d",
"smoothed_worried_become_ill",
"smoothed_worried_finances"
)
state_files <- list.files(ox_region_path, pattern="*.csv", full.names=FALSE)
state_files <- state_files[grep("US", state_files, fixed =TRUE)]
source('~/github/xprize/code/script-get-CMU-covidcast-data.R', echo=TRUE)
# load library
library(covidcast)
library(dplyr)
library(stringr)
ox_region_path <- "../data/oxford/region/" # Oxford data
output_path <- "../data/CMU-covidcast/"
cmu_ili_cli_signals <- c(
"raw_cli",
"smoothed_cli",
"raw_ili",
"smoothed_ili",
"raw_wcli",
"smoothed_wcli",
"raw_wili",
"smoothed_wili",
"raw_hh_cmnty_cli",
"smoothed_hh_cmnty_cli",
"raw_nohh_cmnty_cli",
"smoothed_nohh_cmnty_cli"
)
cmu_behavior_signals <- c(
"smoothed_wearing_mask",
"smoothed_others_masked",
"smoothed_travel_outside_state_5d",
"smoothed_work_outside_home_1d",
"smoothed_shop_1d",
"smoothed_restaurant_1d",
"smoothed_spent_time_1d",
"smoothed_large_event_1d",
"smoothed_public_transit_1d"
)
cmu_testing_signals <- c(
"smoothed_tested_14d",
"smoothed_tested_positive_14d",
"smoothed_wanted_test_14d"
)
cmu_mental_health_signals <- c(
"smoothed_anxious_5d",
"smoothed_depressed_5d",
"smoothed_felt_isolated_5d",
"smoothed_worried_become_ill",
"smoothed_worried_finances"
)
all_signals <- c(cmu_ili_cli_signals, cmu_behavior_signals, cmu_testing_signals, cmu_mental_health_signals)
all_signals
source('~/github/xprize/code/script-get-CMU-covidcast-data.R', echo=TRUE)
source('~/github/xprize/code/script-get-CMU-covidcast-data.R', echo=TRUE)
ox_region_path <- "../data/oxford/region/" # Oxford data
state_files <- list.files(ox_region_path, pattern="*.csv", full.names=FALSE)
state_files
#state_files <- c("US_AK-estimate.csv", "US_AL-estimate.csv")
state_files <- state_files[grep("US", state_files, fixed =TRUE)]
state_files
iso2 <- word(state_files,1,sep = "-")
iso2
state_codes <- tolower(word(iso2,2,sep = "_"))
state_files <- list.files(ox_region_path, pattern="*.csv", full.names=TRUE)
state_files
df_all <- lapply(state_files, read.csv)
dim(df_all)
df_all
state_files <- list.files(ox_region_path, pattern="*.csv", full.names=TRUE)
state_files <- state_files[grep("US", state_files, fixed =TRUE)]
# Reads all files
df_all <- lapply(state_files, read.csv)
state_files <- list.files(ox_region_path, pattern="*.csv", full.names=FALSE)
iso2 <- word(state_files,1,sep = "-")
state_codes <- tolower(word(iso2,2,sep = "_"))
names(df_all) <- state_codes
state_files <- list.files(ox_region_path, pattern="*.csv", full.names=TRUE)
state_files <- state_files[grep("US", state_files, fixed =TRUE)]
state_files
state_files <- list.files(ox_region_path, pattern="*.csv", full.names=TRUE)
state_files <- state_files[grep("US", state_files, fixed =TRUE)]
# Reads all files
df_all <- lapply(state_files, read.csv)
state_files <- list.files(ox_region_path, pattern="*.csv", full.names=FALSE)
state_files <- state_files[grep("US", state_files, fixed =TRUE)]
iso2 <- word(state_files,1,sep = "-")
state_codes <- tolower(word(iso2,2,sep = "_"))
names(df_all) <- state_codes
# load library
library(covidcast)
library(dplyr)
library(stringr)
ox_region_path <- "../data/oxford/region/" # Oxford data
output_path <- "../data/CMU-covidcast/"
cmu_ili_cli_signals <- c(
"raw_cli",
"smoothed_cli",
"raw_ili",
"smoothed_ili",
"raw_wcli",
"smoothed_wcli",
"raw_wili",
"smoothed_wili",
"raw_hh_cmnty_cli",
"smoothed_hh_cmnty_cli",
"raw_nohh_cmnty_cli",
"smoothed_nohh_cmnty_cli"
)
cmu_behavior_signals <- c(
"smoothed_wearing_mask",
"smoothed_others_masked",
"smoothed_travel_outside_state_5d",
"smoothed_work_outside_home_1d",
"smoothed_shop_1d",
"smoothed_restaurant_1d",
"smoothed_spent_time_1d",
"smoothed_large_event_1d",
"smoothed_public_transit_1d"
)
cmu_testing_signals <- c(
"smoothed_tested_14d",
"smoothed_tested_positive_14d",
"smoothed_wanted_test_14d"
)
cmu_mental_health_signals <- c(
"smoothed_anxious_5d",
"smoothed_depressed_5d",
"smoothed_felt_isolated_5d",
"smoothed_worried_become_ill",
"smoothed_worried_finances"
)
all_signals <- c(cmu_ili_cli_signals, cmu_behavior_signals, cmu_testing_signals, cmu_mental_health_signals)
state_files <- list.files(ox_region_path, pattern="*.csv", full.names=TRUE)
state_files <- state_files[grep("US", state_files, fixed =TRUE)]
# Reads all files
df_all <- lapply(state_files, read.csv)
state_files <- list.files(ox_region_path, pattern="*.csv", full.names=FALSE)
state_files <- state_files[grep("US", state_files, fixed =TRUE)]
iso2 <- word(state_files,1,sep = "-")
state_codes <- tolower(word(iso2,2,sep = "_"))
names(df_all) <- state_codes
for (code in state_codes) {
cat("Init ", code, "\n")
df_all[code] <- df_all[code] %>%
select(date=Date, iso2)
df_all[code]$date <- as.Date(df_all[code]$date)
}
for (code in state_codes) {
cat("Init ", code, "\n")
df_all[[code]] <- df_all[[code]] %>%
select(date=Date, iso2)
df_all[[code]]$date <- as.Date(df_all[[code]]$date)
}
df_all[["ar"]]
source('~/github/xprize/code/script-get-CMU-covidcast-data2.R', echo=TRUE)
source('~/github/xprize/code/script-get-CMU-covidcast-data2.R', echo=TRUE)
source('~/github/xprize/code/script-stitch-region-data.R', echo=TRUE)
cmu_data <- c(
"cmu_date",
"cmu_iso2",
"cmu_raw_cli",
"cmu_smoothed_cli",
"cmu_raw_ili",
"cmu_smoothed_ili",
"cmu_raw_wcli",
"cmu_smoothed_wcli",
"cmu_raw_wili",
"cmu_smoothed_wili",
"cmu_raw_hh_cmnty_cli",
"cmu_smoothed_hh_cmnty_cli",
"cmu_raw_nohh_cmnty_cli",
"cmu_smoothed_nohh_cmnty_cli",
"cmu_smoothed_wearing_mask",
"cmu_smoothed_others_masked",
"cmu_smoothed_travel_outside_state_5d",
"cmu_smoothed_work_outside_home_1d",
"cmu_smoothed_shop_1d",
"cmu_smoothed_restaurant_1d",
"cmu_smoothed_spent_time_1d",
"cmu_smoothed_large_event_1d",
"cmu_smoothed_public_transit_1d",
"cmu_smoothed_tested_14d",
"cmu_smoothed_tested_positive_14d",
"cmu_smoothed_wanted_test_14d",
"cmu_smoothed_anxious_5d",
"cmu_smoothed_depressed_5d",
"cmu_smoothed_felt_isolated_5d",
"cmu_smoothed_worried_become_ill",
"cmu_smoothed_worried_finances"
)
source('~/github/xprize/code/estimates-regeneration-v2.R', echo=TRUE)
source('~/github/xprize/code/script-get-google-mobility-data.R', echo=TRUE)
source('~/github/xprize/code/script-get-google-mobility-data.R', echo=TRUE)
source('~/github/xprize/code/script-get-google-mobility-data.R', echo=TRUE)
# load library
library(dplyr)
library(ggplot2)
library(httr)
library(jsonlite)
library(stringr)
library(data.table)
#DATA_URL = "https://www.gstatic.com/covid19/mobility/Global_Mobility_Report.csv"
DATA_URL = "/Users/anto/Downloads/Global_Mobility_Report.csv"
# country_file <- "../data/common-data/oxford-countries.csv"
# region_file <- "../data/common-data/oxford-regions.csv"
output_path = "../data/google-mobility/"
df_country <- read.csv(DATA_URL)
cat("::- script-confirmed: Google Mobility data is available! ::\n")
all_countries <- unique(df_country$country_region_code)
all_countries
all_countries <- all_countries[!is.na(all_countries)]
all_countries
source('~/github/xprize/code/script-get-google-mobility-data.R', echo=TRUE)
source('~/github/xprize/code/script-get-google-mobility-data.R', echo=TRUE)
source('~/github/xprize/code/script-get-google-mobility-data.R', echo=TRUE)
source('~/github/xprize/code/script-get-google-mobility-data.R', echo=TRUE)
source('~/github/xprize/code/script-get-google-mobility-data.R', echo=TRUE)
# load library
library(dplyr)
library(ggplot2)
library(httr)
library(jsonlite)
library(stringr)
library(data.table)
#DATA_URL = "https://www.gstatic.com/covid19/mobility/Global_Mobility_Report.csv"
DATA_URL = "/Users/anto/Downloads/Global_Mobility_Report.csv"
output_path = "../data/google-mobility/"
df_country <- read.csv(DATA_URL)
cat("::- script-confirmed: Google Mobility data is available! ::\n")
df_country <- df_country[!is.na(df_country$country_region_code),] # There are rows with (country_region_code = NA)
all_countries <- unique(df_country$country_region_code)
all_countries <- all_countries[!is.na(all_countries)]
for (country in all_countries) {
cat("Processing", country)
df <- df_country[df_country$country_region_code == country,]
df <- df[df$sub_region_1 == "",]
cat(" rows: ", nrow(df), "\n")
write.csv(df, paste0(output_path, country, "-estimate.csv"),
row.names = FALSE)
}
for (country in all_countries) {
cat("Processing", country)
df <- df_country[df_country$country_region_code == country,]
df <- df[df$sub_region_1 == "",]
df <- df[df$sub_region_2 == "",]
df <- df[df$metro_area == "",]
df <- df[df$iso_3166_2_code == "",]
cat(" rows: ", nrow(df), "\n")
write.csv(df, paste0(output_path, country, "-estimate.csv"),
row.names = FALSE)
}
df_country$iso_3166_2_code <- gsub("-", "_", df_country$iso_3166_2_code)
all_regions <- unique(df_country$iso_3166_2_code)
all_regions <- all_regions[all_regions != ""]
all_regions <- all_regions[!is.na(all_regions)]
all_regions
for (region in all_regions) {
cat("Processing", region, "\n")
df <- df_country[df_country$iso_3166_2_code == region,]
cat("with regions ", nrow(df), "\n")
write.csv(df, paste0(output_path, region, "-estimate.csv"),
row.names = FALSE)
}
source('~/github/xprize/code/script-get-google-mobility-data.R', echo=TRUE)
source('~/github/xprize/code/script-stitch-country-data.R', echo=TRUE)
source('~/github/xprize/code/script-stitch-region-data.R', echo=TRUE)
install.packages("fdaoutlier")
install.packages(c("caret", "gsubfn", "mpath"))
source('~/github/xprize/code/script-symp-to-death-correlation-multicountry-V5-cutoff.R', echo=TRUE)
source('~/github/xprize/code/script-symp-to-death-correlation-multicountry-V5-cutoff.R', echo=TRUE)
source('~/github/xprize/code/script-ggplot-baseline-vs-predicted-many-sync.R', echo=TRUE)
source('~/github/xprize/code/script-symp-to-death-correlation-multicountry-V5-cutoff.R', echo=TRUE)
source('~/github/xprize/code/script-ggplot-baseline-vs-predicted-many-sync.R', echo=TRUE)
source('~/github/xprize/code/script-ggplot-baseline-vs-predicted-many-sync.R', echo=TRUE)
source('~/github/xprize/code/script-get-oxford-data.R', echo=TRUE)
source('~/github/xprize/code/script-get-oxford-data.R', echo=TRUE)
# Download data from the Oxford site
try(source("script-get-oxford-data.R"), silent = T)
# Download data from the Our World in Data site
try(source("script-get-owid-data.R"), silent = T)
# Download data from the UMD site using the API. Includes smoothing (not past smoothing, too slow)
try(source("script-get-umd-data-country.R"), silent = T)
# Download the data about confirmed cases, deaths, hospital, icu, etc. and accumulate for weeks
try(source("script-confirmed2.R"), silent = T) # Downloads all country cases and deaths from ECDC
try(source("script-confirmed-hospital.R"), silent = T) # Downloads hospital and ICU occupancy from ECDC
# Compute estimates from the CoronaSurveys responses
try(source("script-W-v2.R"), silent = T)
#try(source("script-W-past-smooth.R"), silent = T)  # Uses smooth_column-v2.R
try(source("script-W-smooth.R"), silent = T)  # Uses smooth_column-v2.R
# Download data from the CMU Covidcast site: US states data
try(source("script-get-CMU-covidcast-data2.R"), silent = T)
# Download data from Gloogle mobility
try(source("script-get-google-mobility-data.R"), silent = T)
source('~/github/xprize/code/script-get-oxford-data.R', echo=TRUE)
# Merge data into giant CSV files per country and region
try(source("script-stitch-country-data.R"), silent = T)
try(source("script-stitch-region-data.R"), silent = T)
